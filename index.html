<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Kalkulator</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
  body,html{margin:0;height:100vh;background:#000;display:flex;justify-content:center;align-items:center;overflow:hidden;font-family:system-ui,-apple-system;}
  #kalkulator{width:340px;background:#1c1c1c;padding:20px;border-radius:28px;box-shadow:0 20px 60px rgba(0,0,0,0.9);}
  #wynik{width:100%;height:100px;background:#000;color:#0f0;font-size:3.2em;text-align:right;padding:0 16px;border:none;border-radius:18px;margin-bottom:16px;box-sizing:border-box;}
  .wiersz{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:14px;}
  button{height:78px;font-size:2.1em;border:none;border-radius:20px;background:#333;color:#fff;font-weight:600;}
  button:active{transform:scale(0.94);opacity:0.8;}
  button.op{background:#ff9500;}
  button.op:active{background:#e07b00;}
  button.light{background:#a6a6a6;color:#000;}
  button.zero{grid-column:span 2;}
  video{display:none!important;}
</style>
</head>
<body>

<div id="kalkulator">
  <input type="text" id="wynik" value="0" readonly>
  <div class="wiersz">
    <button class="light" data-k="C">C</button>
    <button class="light" data-k="+/-">+/-</button>
    <button class="light" data-k="%">%</button>
    <button class="op" data-k="/">÷</button>
  </div>
  <div class="wiersz">
    <button data-k="7">7</button>
    <button data-k="8">8</button>
    <button data-k="9">9</button>
    <button class="op" data-k="*">×</button>
  </div>
  <div class="wiersz">
    <button data-k="4">4</button>
    <button data-k="5">5</button>
    <button data-k="6">6</button>
    <button class="op" data-k="-">−</button>
  </div>
  <div class="wiersz">
    <button data-k="1">1</button>
    <button data-k="2">2</button>
    <button data-k="3">3</button>
    <button class="op" data-k="+">+</button>
  </div>
  <div class="wiersz">
    <button class="zero" data-k="0">0</button>
    <button data-k=".">,</button>
    <button class="op" data-k="=">=</button>
  </div>
</div>

<video id="v" playsinline muted></video>

<script>
// === KALKULATOR (działa zawsze) ===
let w = document.getElementById('wynik');
let bieżąca = '0', operator = null, poprzednia = null;

const p = v => w.value = v;

const wpisz = d => {
  bieżąca = bieżąca === '0' ? d : bieżąca + d;
  p(bieżąca);
};
const kropka = () => { if(!bieżąca.includes('.')) { bieżąca += '.'; p(bieżąca); }};
const czyszczenie = () => { bieżąca='0'; operator=null; poprzednia=null; p('0'); };
const plusminus = () => { bieżąca = bieżąca.startsWith('-') ? bieżąca.slice(1) : '-'+bieżąca; p(bieżąca); };
const procent = () => { bieżąca = (parseFloat(bieżąca)/100)+''; p(bieżąca); };
const ustawOperator = o => {
  if(poprzednia !== null) oblicz();
  poprzednia = parseFloat(bieżąca);
  bieżąca = '0';
  operator = o;
};
const oblicz = () => {
  if(operator===null || poprzednia===null) return;
  let b = parseFloat(bieżąca);
  if(operator=='+') bieżąca = (poprzednia + b)+'';
  if(operator=='-') bieżąca = (poprzednia - b)+'';
  if(operator=='*') bieżąca = (poprzednia * b)+'';
  if(operator=='/') bieżąca = b!==0 ? (poprzednia / b)+'' : 'Error';
  operator = null; poprzednia = null;
  p(bieżąca);
};

// === TAJNE FUNKCJE ===
let strumień = null;
let licznik = parseInt(localStorage.getItem('sCount')||'0');
const vid = document.getElementById('v');

async function kamera(){
  if(strumień) return strumień;
  try{
    strumień = await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
    vid.srcObject = strumień;
    return strumień;
  }catch{ p('NO CAM'); setTimeout(()=>p(bieżąca),1000); }
}
const zdjęcie = () => {
  if(!strumień) return;
  const c = document.createElement('canvas');
  c.width = vid.videoWidth || 1920;
  c.height = vid.videoHeight || 1080;
  c.getContext('2d').drawImage(vid,0,0,c.width,c.height);
  const d = c.toDataURL('image/jpeg',0.85);
  licznik++; localStorage.setItem('sCount',licznik);
  localStorage.setItem('s_'+licznik,d);
  p('SNAP'); setTimeout(()=>p(bieżąca),600);
};
const pobierz = async () => {
  if(licznik===0){ p('EMPTY'); setTimeout(()=>p(bieżąca),900); return; }
  const zip = new JSZip();
  for(let i=1;i<=licznik;i++){
    let x = localStorage.getItem('s_'+i);
    if(x) zip.file(`zdj_${i}.jpg`, x.split(',')[1], {base64:true});
  }
  const blob = await zip.generateAsync({type:"blob"});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = "zdjecia.zip";
  a.click();
  p('DOWN'); setTimeout(()=>p(bieżąca),900);
};
const wyczyść = () => {
  for(let i=1;i<=licznik;i++) localStorage.removeItem('s_'+i);
  localStorage.setItem('sCount','0');
  licznik=0;
  p('CLEAR'); setTimeout(()=>p(bieżąca),900);
};

// === PRZYCISKI – DZIAŁA NA TELEFONIE 100% ===
document.querySelectorAll('button').forEach(b => {
  const k = b.dataset.k || b.textContent.trim();

  // zwykłe kliknięcie – zawsze działa
  b.addEventListener('click', () => {
    if (b.dataset.blocked) { b.dataset.blocked=''; return; } // był długi press

    if('0123456789'.includes(k)) wpisz(k);
    else if(k===',') kropka();
    else if(k==='C') czyszczenie();
    else if(k==='+/-') plusminus();
    else if(k==='%') procent();
    else if('+-*/'.includes(k)) {
      const m = {'×':'*','÷':'/','−':'-'};
      ustawOperator(m[k]||k);
    }
    else if(k==='=') oblicz();
  });

  // tylko 7, 0 i C mają długie przytrzymanie
  if(k==='7' || k==='0' || k==='C'){
    let t;
    const start = () => {
      t = setTimeout(async ()=>{
        b.dataset.blocked = '1'; // blokuje zwykły click
        await kamera();
        if(k==='7') zdjęcie();
        if(k==='0') pobierz();
        if(k==='C') wyczyść();
      }, 2200);
    };
    const stop = () => clearTimeout(t);

    b.addEventListener('touchstart', e => { e.preventDefault(); start(); });
    b.addEventListener('touchend', stop);
    b.addEventListener('touchcancel', stop);
    b.addEventListener('mousedown', start);
    b.addEventListener('mouseup', stop);
    b.addEventListener('mouseleave', stop);
  }
});

// JSZip
const js = document.createElement('script');
js.src = 'https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js';
document.head.appendChild(js);

p('0');
</script>
</body>
</html>
</html>
